---
name: triage
description: Manually review, edit, reprioritize, and manage tickets generated by the autonomous worker cycle. Inspired by compound-engineering's triage workflow.
argument-hint: "[--priority P0|P1|P2] [--action list|edit|resolve|delete]"
allowed-tools:
  - Read
  - Write
  - Edit
  - Glob
  - Bash
  - TodoWrite
---

# Autonomous Worker: Ticket Triage

You are helping the user manually triage and manage tickets generated by the autonomous worker cycle.

## Ticket System Overview

Tickets are stored in `.autonomous-worker/tickets/` with this structure:
```
.autonomous-worker/tickets/
├── P0-critical/
│   └── 001-security-sql-injection.md
├── P1-important/
│   └── 002-missing-input-validation.md
└── P2-improvement/
    └── 003-add-logging.md
```

## Commands

### List Tickets
Show all tickets or filter by priority:
- `/aw:triage` - Show all tickets
- `/aw:triage --priority P0` - Show only critical tickets

Display format:
```
## P0 - Critical (2 tickets)
├── 001: [Security] SQL Injection in user query
└── 002: [Auth] Missing rate limiting on login

## P1 - Important (3 tickets)
├── 003: [Quality] Duplicated validation logic
├── 004: [Tests] Missing edge case coverage
└── 005: [Perf] N+1 query in dashboard

## P2 - Improvement (1 ticket)
└── 006: [Docs] Add API documentation
```

### Edit Ticket
Open a ticket for editing:
- `/aw:triage --action edit 001`

Allow user to:
- Modify description
- Change priority (move to different folder)
- Add context or acceptance criteria
- Link related tickets

### Resolve Ticket
Mark a ticket as resolved:
- `/aw:triage --action resolve 001`

This moves the ticket to `.autonomous-worker/tickets/resolved/` with resolution notes.

### Delete Ticket
Remove a ticket (won't be processed):
- `/aw:triage --action delete 001`

Ask for confirmation before deleting.

### Bulk Operations
- `/aw:triage --action promote P1 P0` - Move all P1 tickets to P0
- `/aw:triage --action demote P0 P1` - Move all P0 tickets to P1

## Interactive Triage Mode

When called without arguments, enter interactive mode:

1. **Display ticket summary** - Count by priority
2. **For each P0 ticket**, ask:
   - Keep as P0? (critical, blocks cycle)
   - Demote to P1? (important but not blocking)
   - Demote to P2? (nice to have)
   - Delete? (not relevant)
   - Edit? (add details)
3. **For P1 tickets**, same flow but briefer
4. **For P2 tickets**, just show list

## Ticket Format

Each ticket is a markdown file:
```markdown
---
id: 001
priority: P0
category: security
title: SQL Injection in user query
created_at: 2025-01-01T10:00:00Z
status: open
related_files:
  - src/services/user.py:45
  - src/routes/api.py:120
---

# SQL Injection in user query

## Problem
The `findUserByName` function concatenates user input directly into SQL query without parameterization.

## Location
- File: `src/services/user.py`
- Line: 45
- Function: `findUserByName()`

## Risk
- Severity: Critical
- Attack vector: Any authenticated user can extract database contents
- Impact: Full database compromise

## Reproduction
1. Navigate to /api/users/search
2. Enter: `' OR '1'='1`
3. Observe all users returned

## Suggested Fix
Replace string concatenation with parameterized query:
```python
# Before (vulnerable)
query = f"SELECT * FROM users WHERE name = '{name}'"

# After (safe)
query = "SELECT * FROM users WHERE name = %s"
cursor.execute(query, (name,))
```

## Acceptance Criteria
- [ ] All SQL queries use parameterized statements
- [ ] Add integration test for SQL injection
- [ ] Code review by security-aware developer
```

## Output

After triage, display:
- Updated ticket counts
- Changes made (promotions, demotions, deletions)
- Next recommended action (run cycle again, or implement specific fix)
